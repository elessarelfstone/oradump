--начисленные доходы (db.tdr)
select 
       report_date_id
||','||to_char(order_date, 'yyyy-mm-dd')
||','||nvl(source_group_id, 1)        
||','||to_char(nvl(service_date, order_date), 'yyyy-mm-dd')
||','||replace(device, ',', ' ')
||','||replace(detail, ',', ' ')
||','||nvl(service_count,  0)
||','||nvl(service_count1, 0)
||','||nvl(service_count2, 0)
||','||nvl(service_count3, 0)
||','||nvl(town_id, 1)
||','||nvl(device_group_id, 0)
||','||nvl(abonent_id, -1)
||','||debit                  
||','||nvl((select id from db.tdr_group tg where tg.id = t.tdr_group_id), 1)
||','||nvl(dbill_type_id, 1)          
||','||nvl(bill_type_id, 5)           
||','||nvl((select id from db.detail_type dt where dt.id = t.detail_type_id), 0)         
||','||nvl(service_count_group_id, 1)
||','||nvl(abonent_group_id, 1)    
||','||nvl(date_factor_type_id, 1)
||','||nvl(factor_type_id, 1)
||','||nvl(nds_type_id, 1)
||','||nvl((select id from db.tariff_type tt where tt.id = t.tariff_type_id), 0)
||','||nvl(discount_type_id, 0)
from db.tdr t
where t.order_date between to_date('{dtbegin}', 'dd.mm.yyyy') and to_date('{dtend}', 'dd.mm.yyyy') + 1 - 1/(86400)